import 'package:injectable/injectable.dart';

import '../../../../../common/utils/api_result.dart';
import '../dto/subscription_dto.dart';
import '../source/subscription_source.dart';

@lazySingleton
class SubscriptionRepository {
  SubscriptionRepository(this._source);

  final SubscriptionSource _source;

  Future<ApiResult<SubscriptionListResponseDto>> fetchSubscriptions() async {
    // TODO: Remove this mock when API is ready
    await Future.delayed(const Duration(seconds: 2));
    final mockData = {
      "message": "Subscriptions list fetched successfully",
      "status": 200,
      "data": {
        "subscriptionList": [
          {
            "course": "Primary School",
            "class_name": "Grade 1",
            "subscription": [
              {
                "id": 48,
                "class_id": 27,
                "amount": 8500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "68439",
                "plan_id_inapp": "1_month_grade_1_R1",
                "time": 30,
                "description": "Allows one month access to Primary 1 videos",
                "detail": null,
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-05-07 14:35:40",
                "updated_at": "2025-10-03 13:04:39",
                "userSubscription": [],
                "classes": {
                  "id": 27,
                  "name": "Grade 1",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 54,
                "class_id": 27,
                "amount": 11500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140176",
                "plan_id_inapp": "140176",
                "time": 90,
                "description": "Allows three months access to Primary 1 videos",
                "detail": "Allows three months access to Primary 1 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-06-05 19:47:10",
                "updated_at": "2025-10-03 13:04:56",
                "userSubscription": [],
                "classes": {
                  "id": 27,
                  "name": "Grade 1",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 55,
                "class_id": 27,
                "amount": 23500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140177",
                "plan_id_inapp": "140177",
                "time": 365,
                "description": "Allows 1 year access to Primary 1 videos",
                "detail": "Allows 1 year access to Primary 1 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-06-05 19:51:24",
                "updated_at": "2025-10-03 13:05:48",
                "userSubscription": [],
                "classes": {
                  "id": 27,
                  "name": "Grade 1",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
            ],
          },
          {
            "course": "Primary School",
            "class_name": "Grade 2",
            "subscription": [
              {
                "id": 29,
                "class_id": 31,
                "amount": 8500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "68441",
                "plan_id_inapp": "1_month_grade_2",
                "time": 30,
                "description": "Allows one month access to Primary 2 videos",
                "detail": null,
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 13:59:11",
                "updated_at": "2025-10-03 13:06:08",
                "userSubscription": [],
                "classes": {
                  "id": 31,
                  "name": "Grade 2",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 31,
                "class_id": 31,
                "amount": 23500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140177",
                "plan_id_inapp": "140177",
                "time": 365,
                "description": "Allows 1 year access to Primary 2 videos",
                "detail": "Allows 1 year access to Primary 2 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 14:00:45",
                "updated_at": "2025-10-03 13:06:55",
                "userSubscription": [],
                "classes": {
                  "id": 31,
                  "name": "Grade 2",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 424,
                "class_id": 31,
                "amount": 11500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "plan-1754302443693",
                "plan_id_inapp": "inapp-plan-1754302443693",
                "time": 90,
                "description": "Allows three months access to Primary 2 videos",
                "detail": "Allows three months access to Primary 2 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2025-08-04 10:13:31",
                "updated_at": "2025-10-03 13:07:24",
                "userSubscription": [],
                "classes": {
                  "id": 31,
                  "name": "Grade 2",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
            ],
          },
          {
            "course": "Primary School",
            "class_name": "Grade 3",
            "subscription": [
              {
                "id": 32,
                "class_id": 32,
                "amount": 8500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "68442",
                "plan_id_inapp": "1_month_grade_3",
                "time": 30,
                "description": "Allows one month access to Primary 3 videos",
                "detail": null,
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 14:01:58",
                "updated_at": "2025-10-03 13:10:07",
                "userSubscription": [],
                "classes": {
                  "id": 32,
                  "name": "Grade 3",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 33,
                "class_id": 32,
                "amount": 11500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140176",
                "plan_id_inapp": "140176",
                "time": 90,
                "description": "Allows three months access to Primary 3 videos",
                "detail": "Allows three months access to Primary 3 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 14:02:25",
                "updated_at": "2025-10-03 13:12:04",
                "userSubscription": [],
                "classes": {
                  "id": 32,
                  "name": "Grade 3",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 34,
                "class_id": 32,
                "amount": 23500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140177",
                "plan_id_inapp": "140177",
                "time": 365,
                "description": "Allows 1 year access to Primary 3 videos",
                "detail": "Allows 1 year access to Primary 3 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 14:03:13",
                "updated_at": "2025-10-03 13:12:59",
                "userSubscription": [],
                "classes": {
                  "id": 32,
                  "name": "Grade 3",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
            ],
          },
          {
            "course": "Primary School",
            "class_name": "Grade 4",
            "subscription": [
              {
                "id": 35,
                "class_id": 33,
                "amount": 8500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "68443",
                "plan_id_inapp": "1_month_grade_4",
                "time": 30,
                "description": "Allows one month access to Primary 4 videos",
                "detail": null,
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 16:42:58",
                "updated_at": "2025-10-03 13:13:31",
                "userSubscription": [],
                "classes": {
                  "id": 33,
                  "name": "Grade 4",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
              {
                "id": 36,
                "class_id": 33,
                "amount": 11500,
                "discount": 0,
                "country_id": "87",
                "plan_id": "140176",
                "plan_id_inapp": "140176",
                "time": 90,
                "description": "Allows three months access to Primary 4 videos",
                "detail": "Allows three months access to Primary 4 videos",
                "subscription_type": "USER",
                "discounted_plan_id": null,
                "discounted_plan_id_inapp": null,
                "created": "2021-03-27 16:43:27",
                "updated_at": "2025-10-03 13:13:31",
                "userSubscription": [],
                "classes": {
                  "id": 33,
                  "name": "Grade 4",
                  "course": {"id": 137, "name": "Primary School"},
                },
              },
            ],
          },
        ],
      },
    };

    final dto = SubscriptionListResponseDto.fromJson(
      mockData["data"] as Map<String, dynamic>,
    );
    return Success(data: dto);
    /*
    return ApiResultWrapper.wrap(
      func: () => _source.getSubscriptions(),
      mapper: (data) =>
          SubscriptionListResponseDto.fromJson(data as Map<String, dynamic>),
    );
    */
  }
}
